import{j as e}from"./jsx-runtime-BLI8ZJsa.js";import{R as u,r as s,b as q}from"./index-CP26dfb2.js";import{R as H}from"./index-CNPq0y9p.js";import{a as K,u as Q,s as U}from"./create-DC3FBBky.js";import"./moment-C5S46NFB.js";import{u as p,c as V}from"./components-BlTBjdub.js";import{B as l,P as y,e as X,T as D,I as f}from"./Page-CP5RaZ3z.js";import{C as Y}from"./Card-cfPGhfhX.js";import{D as $,S as ee,a as te}from"./DataTable-Bwh0IRBP.js";var S=function(m){return u.createElement("svg",Object.assign({viewBox:"0 0 20 20"},m),u.createElement("path",{d:"M3.5 9.25a.75.75 0 0 0 1.5 0 3 3 0 0 1 3-3h6.566l-1.123 1.248a.75.75 0 1 0 1.114 1.004l2.25-2.5a.75.75 0 0 0-.027-1.032l-2.25-2.25a.75.75 0 1 0-1.06 1.06l.97.97h-6.44a4.5 4.5 0 0 0-4.5 4.5Z"}),u.createElement("path",{d:"M16.5 10.75a.75.75 0 0 0-1.5 0 3 3 0 0 1-3 3h-6.566l1.123-1.248a.75.75 0 1 0-1.114-1.004l-2.25 2.5a.75.75 0 0 0 .027 1.032l2.25 2.25a.75.75 0 0 0 1.06-1.06l-.97-.97h6.44a4.5 4.5 0 0 0 4.5-4.5Z"}))};S.displayName="RefreshIcon";function pe(b){const[m,se]=s.useState(1),[v,C]=s.useState(null),[E,d]=s.useState(!0),[r,k]=s.useState([]),A=p(),i=p(),c=p(),g=q();V();const I=H(),_=K(),n=Q(t=>t.user.user),[o,R]=s.useState({}),[M,x]=s.useState(!1),[P,T]=s.useState(""),w=s.useCallback(()=>x(t=>!t),[]),B=M?shopify.toast.show(P,{duration:1e3,onDismiss:w}):null;s.useEffect(()=>{if(typeof window<"u"){const t=I.config;C(t)}},[]);const N=()=>{A.submit({shopifyShopId:v.shop},{method:"post",action:"/data/users/delete"}),window.location.reload()},h=()=>{d(!0),i.submit({shopifyShopId:n==null?void 0:n.shopifyShopId},{method:"post",action:"/data/pins/get"})},J=(t,a)=>{c.submit({access_key:n==null?void 0:n.accessToken,id:t,pin_id:a},{method:"post",action:"/data/pins/delete"})},O=t=>{_(U(t)),g("/app/create_pin")};s.useEffect(()=>{h()},[]),s.useEffect(()=>{var t;(t=c==null?void 0:c.data)!=null&&t.success&&(T("Pin deleted successfully."),x(!0),h())},[c.data]),s.useEffect(()=>{if(console.log("inside useEffect"),Object.keys((i==null?void 0:i.data)??{}).length>0){const t=Object.values(i.data).map(a=>{let z=JSON.parse(a.pinterestJson),j=a.productEditJson?JSON.parse(a.productEditJson):{};const F=a.status==="draft"?e.jsx(l,{children:"Draft"}):a.status==="scheduled"?e.jsx(l,{variant:"primary",tone:"critical",children:"Waiting"}):a.status==="published"?e.jsx(l,{variant:"primary",tone:"success",children:"Published"}):null,G=e.jsxs("div",{style:{display:"flex",gap:"7px"},children:[e.jsx("div",{className:"dash-action-icon-edit",onClick:()=>O(j),children:e.jsx(f,{source:ee,tone:"base"})}),e.jsx("div",{className:"dash-action-icon-delete",onClick:()=>{R({id:a.id,pin_id:z.id}),L(!0),shopify.modal.show("delete-modal")},children:e.jsx(f,{source:te,tone:"base"})})]});return[a.product_title,j.title,F,new Date(a.createdAt).toLocaleDateString("en-GB",{day:"2-digit",month:"long",year:"numeric"}),G]});k(t),d(!1)}else d(!1)},[i.data]);const[ae,L]=s.useState(!1),W=()=>{shopify.modal.hide("delete-modal")},Z=()=>{shopify.modal.hide("delete-modal"),J(o==null?void 0:o.id,o==null?void 0:o.pin_id)};return e.jsxs("div",{children:[e.jsxs(y,{children:[B,e.jsx(y,{style:{display:"block"},title:"Dashboard",fullWidth:!0,subtitle:"The integration process guide through the main features of the application.",compactTitle:!0,secondaryActions:e.jsxs("div",{style:{display:"flex",gap:"7px"},children:[e.jsx(l,{onClick:()=>{h()},children:e.jsx(f,{source:S,tone:"base"})}),e.jsx(l,{onClick:()=>{N()},children:"Disconnect Pinterest"}),e.jsx(l,{onClick:()=>{g("/app/boards")},children:"Boards"})]}),children:e.jsx(Y,{children:E?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsx(X,{size:"large"})}):r&&r.length>0?e.jsx($,{columnContentTypes:[],headings:["Product","Title Pin","Status","Date of Creation","Actions"],rows:r}):e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsx(D,{children:"No Pins Found"})})})})]}),e.jsxs("ui-modal",{id:"delete-modal",children:[e.jsx("div",{gap:"4",children:e.jsx(D,{children:"Are you sure you want to delete this pin?"})}),e.jsxs("ui-title-bar",{title:"Delete Item",children:[e.jsx("button",{variant:"primary",tone:"critical",onClick:Z,children:"Delete"}),e.jsx("button",{onClick:W,children:"Cancel"})]})]})]})}export{pe as D};
