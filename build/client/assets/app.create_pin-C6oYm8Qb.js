import{j as t}from"./jsx-runtime-BLI8ZJsa.js";import A from"./ThemeLayout-CSZUhtdd.js";import{u as D,b as U,r as h}from"./index-CP26dfb2.js";import{u as P,a as F,s as c}from"./create-DC3FBBky.js";import"./react-toastify.esm-DDqzjVhy.js";import{R as I}from"./index-CNPq0y9p.js";import{u as Z}from"./components-BlTBjdub.js";import{P as V,a as p,T as $,B as L}from"./Page-CP5RaZ3z.js";import{C as B}from"./Card-cfPGhfhX.js";import{F as N}from"./Form-FMERqV2F.js";import{S as O}from"./Select-Cqc2aBNG.js";import"./styles-D_XvpvLC.js";import"./moment-C5S46NFB.js";import"./index-EHAiWlOd.js";import"./AuthChecker-CNFSFa96.js";import"./context-CVOPGIzy.js";function W(u){var g,b,j,y,v,C,T;const x=D(),l=U(),i=Z();let{product:o}=x.state??{};const[R,S]=h.useState([]),[E,d]=h.useState(!1),[H,M]=h.useState(""),e=P(s=>{var r;return(r=s.new_pin)==null?void 0:r.data}),m=P(s=>s.user.user),a=F();I().config.shop,h.useEffect(()=>{var s,r,n;q(e!=null&&e.edited_pin_base64?e==null?void 0:e.edited_pin_base64:(n=(r=(s=e==null?void 0:e.product)==null?void 0:s.node)==null?void 0:r.featuredImage)==null?void 0:n.url,function(k){a(c({...e,product_image_base64:k}))}),i.submit({access_key:m==null?void 0:m.accessToken},{method:"post",action:"/api/pinterest/boards"})},[]),h.useEffect(()=>{var r;let s=[{label:"Select",value:""}];Object.values(((r=i==null?void 0:i.data)==null?void 0:r.items)??[]).map(n=>{s.push({label:n.name,value:n.id})}),e!=null&&e.board_id||Object.keys(s).length>0&&a(c({...e,board_id:s[0].value})),S(s)},[i==null?void 0:i.data]);const f=s=>{d(!0),(e==null?void 0:e.title)==""?(shopify.toast.show("Please enter the title"),d(!1)):(e==null?void 0:e.description)==""?(shopify.toast.show("Please enter the description"),d(!1)):(e==null?void 0:e.destination_url)==""||(e==null?void 0:e.destination_url)==null?(shopify.toast.show("Please enter the destination url"),d(!1)):(e==null?void 0:e.board_id)==null||(e==null?void 0:e.board_id)==""?(shopify.toast.show("Please select a board"),d(!1)):l("/app/preview_and_publish")},z=s=>{a(c({...e,board_id:s}))};return t.jsx("div",{children:t.jsx(V,{style:{display:"block"},title:"Create Pin",fullWidth:!0,subtitle:"Create and customize your Pinterest pin",compactTitle:!0,children:t.jsxs(B,{children:[t.jsx(N,{onSubmit:f,children:t.jsx("div",{style:{padding:"1.5rem"},children:t.jsxs("div",{style:{display:"flex",gap:"60px"},children:[t.jsxs("div",{style:{width:"60%"},children:[t.jsx("div",{style:{marginTop:"30px"},children:t.jsx(p,{value:e==null?void 0:e.title,defaultValue:(g=o==null?void 0:o.node)==null?void 0:g.title,onChange:s=>{s&&s.length<=100&&a(c({...e,title:s}))},label:"PIN Title",type:"text",placeholder:"Enter the title",autoComplete:"text",maxLength:100,minLength:0,helpText:t.jsxs("span",{children:[100-((b=e==null?void 0:e.title)==null?void 0:b.length)," characters left"]})})}),t.jsx("div",{style:{marginTop:"15px"},children:t.jsx(p,{value:e==null?void 0:e.description,defaultValue:(j=o==null?void 0:o.node)==null?void 0:j.description,onChange:s=>{s&&s.length<=700&&a(c({...e,description:s}))},label:"Description",type:"text",multiline:8,maxLength:500,helpText:t.jsxs("span",{children:[700-((y=e==null?void 0:e.description)==null?void 0:y.length)," characters left"]})})}),t.jsx("div",{style:{marginTop:"15px"},children:t.jsx(p,{value:e==null?void 0:e.destination_url,onChange:s=>{a(c({...e,destination_url:s}))},def:!0,label:"Destination URL",type:"text",placeholder:"Enter the URL",error:e!=null&&e.destination_url&&!G(e==null?void 0:e.destination_url)?"Please enter a valid URL":void 0})}),t.jsx("div",{style:{marginTop:"15px"},children:t.jsx(O,{label:"Pinterest Board Selection",options:R,onChange:s=>{z(s)},value:`${e==null?void 0:e.board_id}`})})]}),t.jsxs("div",{style:{width:"40%"},children:[(e==null?void 0:e.edited_pin_base64)==null?t.jsxs("div",{style:{width:"100%",padding:"30px"},children:[t.jsx("div",{style:{width:"100%",height:"100px",display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx($,{as:"h1",variant:"heading2xl",fontWeight:"bold",children:e==null?void 0:e.title})}),t.jsx("div",{style:{width:"100%"},children:t.jsx("img",{style:{width:"100%"},src:(T=(C=(v=e==null?void 0:e.product)==null?void 0:v.node)==null?void 0:C.featuredImage)==null?void 0:T.url})})]}):t.jsx("div",{children:t.jsx("img",{src:e==null?void 0:e.edited_pin_base64,style:{width:"100%"}})}),t.jsx("div",{})]})]})})}),t.jsxs("div",{style:{marginTop:"30px",display:"flex",gap:"15px",justifyContent:"center"},children:[t.jsx(L,{to:"select_product",variant:"primary",tone:"critical",size:"large",type:"button",onClick:()=>{l("/app")},children:"Cancel"}),t.jsx(L,{to:"select_product",size:"large",type:"submit",onClick:()=>{f()},loading:E,children:"Save"})]})]})})})}function q(u,x){var l=new XMLHttpRequest;l.onload=function(){var i=new FileReader;i.onloadend=function(){x(i.result)},i.readAsDataURL(l.response)},l.open("GET",u),l.responseType="blob",l.send()}const G=u=>!!new RegExp("^(https?:\\/\\/)?((([a-zA-Z0-9$-_@.&+!*\\(\\),]+\\.)+[a-zA-Z]{2,})|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-zA-Z0-9@:%_+.~#?&//=]*)?(\\?[;&a-zA-Z0-9%_+.~#?&//=]*)?(\\#[-a-zA-Z0-9_]*)?$","i").test(u);function ne(){return t.jsx(A,{children:t.jsx(W,{})})}export{ne as default};
